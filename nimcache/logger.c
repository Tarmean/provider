/* Generated by Nim Compiler v0.13.0 */
/*   (c) 2015 Andreas Rumpf */
/* The generated code is subject to the original license. */
/* Compiled for: Linux, amd64, gcc */
/* Command for C compiler:
   gcc -c  -w -pthread  -I/usr/lib/nim -o /home/cyril/Projects/provider/nimcache/logger.o /home/cyril/Projects/provider/nimcache/logger.c */
#define NIM_INTBITS 64

#include "nimbase.h"
#include <sys/types.h>
#include <string.h>
#include <time.h>
#include <stdio.h>
#define _GNU_SOURCE
#include <pthread.h>
#include <stdlib.h>
typedef struct TY192035 TY192035;
typedef struct Logger192006 Logger192006;
typedef struct TGenericSeq TGenericSeq;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct Cell54507 Cell54507;
typedef struct Cellseq54523 Cellseq54523;
typedef struct Gcheap56818 Gcheap56818;
typedef struct Gcstack56816 Gcstack56816;
typedef struct Cellset54519 Cellset54519;
typedef struct Pagedesc54515 Pagedesc54515;
typedef struct Memregion36688 Memregion36688;
typedef struct Smallchunk36640 Smallchunk36640;
typedef struct Llchunk36682 Llchunk36682;
typedef struct Bigchunk36642 Bigchunk36642;
typedef struct Intset36614 Intset36614;
typedef struct Trunk36610 Trunk36610;
typedef struct Avlnode36686 Avlnode36686;
typedef struct Gcstat56814 Gcstat56814;
typedef struct Channel90204 Channel90204;
typedef struct Thread23035 Thread23035;
typedef struct Gcthread20006 Gcthread20006;
typedef struct Message192010 Message192010;
typedef struct NimStringDesc NimStringDesc;
typedef struct Deadthreaderror3678 Deadthreaderror3678;
typedef struct Exception Exception;
typedef struct TNimObject TNimObject;
typedef struct Timeinfo115804 Timeinfo115804;
typedef struct Basechunk36638 Basechunk36638;
typedef struct Freecell36630 Freecell36630;
struct  Logger192006  {
FILE* file;
};
struct  TGenericSeq  {
NI len;
NI reserved;
};
typedef N_NIMCALL_PTR(void, TY3489) (void* p, NI op);
typedef N_NIMCALL_PTR(void*, TY3494) (void* p);
struct  TNimType  {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY3489 marker;
TY3494 deepcopy;
};
struct  TNimNode  {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct  Cell54507  {
NI refcount;
TNimType* typ;
};
struct  Cellseq54523  {
NI len;
NI cap;
Cell54507** d;
};
struct  Cellset54519  {
NI counter;
NI max;
Pagedesc54515* head;
Pagedesc54515** data;
};
typedef Smallchunk36640* TY36703[512];
typedef Trunk36610* Trunkbuckets36612[256];
struct  Intset36614  {
Trunkbuckets36612 data;
};
struct  Memregion36688  {
NI minlargeobj;
NI maxlargeobj;
TY36703 freesmallchunks;
Llchunk36682* llmem;
NI currmem;
NI maxmem;
NI freemem;
NI lastsize;
Bigchunk36642* freechunkslist;
Intset36614 chunkstarts;
Avlnode36686* root;
Avlnode36686* deleted;
Avlnode36686* last;
Avlnode36686* freeavlnodes;
};
struct  Gcstat56814  {
NI stackscans;
NI cyclecollections;
NI maxthreshold;
NI maxstacksize;
NI maxstackcells;
NI cycletablesize;
NI64 maxpause;
};
struct  Gcheap56818  {
Gcstack56816* stack;
void* stackbottom;
NI cyclethreshold;
Cellseq54523 zct;
Cellseq54523 decstack;
Cellset54519 cycleroots;
Cellseq54523 tempstack;
NI recgclock;
Memregion36688 region;
Gcstat56814 stat;
};
struct  Channel90204  {
NI rd;
NI wr;
NI count;
NI mask;
NU8* data;
pthread_mutex_t lock;
pthread_cond_t cond;
TNimType* elemtype;
NIM_BOOL ready;
Memregion36688 region;
};
struct  Gcthread20006  {
pthread_t sys;
};
typedef N_NIMCALL_PTR(void, TY21810) (void);
struct  Thread23035  {
  Gcthread20006 Sup;
TY21810 datafn;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
struct  Message192010  {
NU8 kind;
union{
struct {NimStringDesc* module;
NimStringDesc* text;
} S1;
struct {TY192035* loggers;
} S2;
} kindU;
};
struct  TNimObject  {
TNimType* m_type;
};
struct  Exception  {
  TNimObject Sup;
Exception* parent;
NCSTRING name;
NimStringDesc* message;
NimStringDesc* trace;
};
struct  Deadthreaderror3678  {
  Exception Sup;
};
struct  Timeinfo115804  {
  TNimObject Sup;
NI second;
NI minute;
NI hour;
NI monthday;
NU8 month;
NI year;
NU8 weekday;
NI yearday;
NIM_BOOL isdst;
NimStringDesc* tzname;
NI timezone;
};
typedef NimStringDesc* TY192201[3];
typedef FILE* TY192483[2];
typedef N_NIMCALL_PTR(void, TY23043) (void);
struct  Gcstack56816  {
Gcstack56816* prev;
Gcstack56816* next;
void* starts;
void* pos;
NI maxstacksize;
};
typedef NI TY36619[8];
struct  Pagedesc54515  {
Pagedesc54515* next;
NI key;
TY36619 bits;
};
struct  Basechunk36638  {
NI prevsize;
NI size;
NIM_BOOL used;
};
struct  Smallchunk36640  {
  Basechunk36638 Sup;
Smallchunk36640* next;
Smallchunk36640* prev;
Freecell36630* freelist;
NI free;
NI acc;
NF data;
};
struct  Llchunk36682  {
NI size;
NI acc;
Llchunk36682* next;
};
struct  Bigchunk36642  {
  Basechunk36638 Sup;
Bigchunk36642* next;
Bigchunk36642* prev;
NI align;
NF data;
};
struct  Trunk36610  {
Trunk36610* next;
NI key;
TY36619 bits;
};
typedef Avlnode36686* TY36693[2];
struct  Avlnode36686  {
TY36693 link;
NI key;
NI upperbound;
NI level;
};
struct  Freecell36630  {
Freecell36630* next;
NI zerofield;
};
struct TY192035 {
  TGenericSeq Sup;
  Logger192006 data[SEQ_DECL_SIZE];
};
N_NIMCALL(TY192035*, newseq_192030)(NI len);
static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src);
static N_INLINE(Cell54507*, usrtocell_58458)(void* usr);
static N_INLINE(void, nimFrame)(TFrame* s);
N_NOINLINE(void, stackoverflow_28801)(void);
static N_INLINE(void, popFrame)(void);
static N_INLINE(void, rtladdzct_60001)(Cell54507* c);
N_NOINLINE(void, addzct_58435)(Cellseq54523* s, Cell54507* c);
N_NIMCALL(void, send_192091)(Channel90204* c, Message192010* msg);
static N_INLINE(void, sysfatal_192107)(NimStringDesc* message) __attribute__((noreturn));
N_NIMCALL(void*, newObj)(TNimType* typ, NI size);
N_NIMCALL(NimStringDesc*, copyStringRC1)(NimStringDesc* src);
static N_INLINE(void, nimGCunrefNoCycle)(void* p);
N_NIMCALL(void, raiseException)(Exception* e, NCSTRING ename);
N_NIMCALL(void, addlogger_192076)(FILE* file);
N_NIMCALL(TGenericSeq*, incrSeqV2)(TGenericSeq* seq, NI elemsize);
N_NOINLINE(void, raiseFieldError)(NimStringDesc* f);
N_NIMCALL(void, genericSeqAssign)(void* dest, void* src_92404, TNimType* mt);
N_NIMCALL(void, recv_192176)(Channel90204* c, Message192010* Result);
N_NIMCALL(NI, peek_192406)(Channel90204* c);
N_NIMCALL(void, threadlog_192142)(void);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* src);
N_NOINLINE(void, chckNil)(void* p);
N_NIMCALL(time_t, gettime_115839)(void);
N_NIMCALL(NIM_BOOL, ntEqTime)(time_t a, time_t b);
N_NIMCALL(NimStringDesc*, format_118012)(Timeinfo115804* info, NimStringDesc* f);
N_NIMCALL(void, getlocaltime_115841)(time_t t, Timeinfo115804* Result);
N_NIMCALL(NimStringDesc*, nsuFormatOpenArray)(NimStringDesc* formatstr, NimStringDesc** a, NI aLen0);
N_NOINLINE(void, raiseIndexError)(void);
N_NIMCALL(void, write_15489)(FILE* f, NimStringDesc* s);
static N_INLINE(NI, addInt)(NI a, NI b);
N_NOINLINE(void, raiseOverflow)(void);
N_NIMCALL(void, failedassertimpl_97116)(NimStringDesc* msg);
static N_INLINE(void, jointhread_192458)(Thread23035* t);
N_NIMCALL(void, close_192465)(Channel90204* c);
static N_INLINE(NIM_BOOL, contains_192487)(FILE** a, NI aLen0, FILE* item);
static N_INLINE(NI, find_192497)(FILE** a, NI aLen0, FILE* item);
N_NOCONV(void, stoplog_192444)(void);
N_NIMCALL(void, send_192563)(NimStringDesc* module, NimStringDesc** args, NI argsLen0);
static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* dest, NI addlen);
N_NIMCALL(void, open_192667)(Channel90204* c);
N_NIMCALL(void, createthread_23028)(Thread23035* t, TY23043 tp);
TNimNode* NimDT_192010_kind[4];
STRING_LITERAL(TMP615, "loggers", 7);
STRING_LITERAL(TMP616, "", 0);
STRING_LITERAL(TMP617, "yyyy-MM-dd HH:mm:ss", 19);
STRING_LITERAL(TMP619, "[$#][$#]: $#\012", 13);
STRING_LITERAL(TMP620, "module", 6);
STRING_LITERAL(TMP621, "text", 4);
STRING_LITERAL(TMP623, "len(a) == L seq modified while iterating over it", 48);
TNimType NTI192006; /* Logger */
extern TNimType NTI15004; /* File */
NU8 loglevel_192026;
TY192035* loggers_192065;
extern NIM_THREADVAR TFrame* frameptr_26036;
extern NIM_THREADVAR Gcheap56818 gch_56859;
Channel90204 channel_192070;
Thread23035 thread_192073;
TNimType NTI192010; /* Message */
TNimType NTI192008; /* MessageKind */
extern TNimType NTI138; /* string */
extern TNimType NTI192035; /* seq[Logger] */
extern TNimType NTI192114; /* ref DeadThreadError */
extern TNimType NTI3678; /* DeadThreadError */
extern TNimType NTI115804; /* TimeInfo */

static N_INLINE(void, nimFrame)(TFrame* s) {
	NI LOC1;
	LOC1 = 0;
	{
		if (!(frameptr_26036 == NIM_NIL)) goto LA4;
		LOC1 = ((NI) 0);
	}
	goto LA2;
	LA4: ;
	{
		LOC1 = ((NI) ((NI16)((*frameptr_26036).calldepth + ((NI16) 1))));
	}
	LA2: ;
	(*s).calldepth = ((NI16) (LOC1));
	(*s).prev = frameptr_26036;
	frameptr_26036 = s;
	{
		if (!((*s).calldepth == ((NI16) 2000))) goto LA9;
		stackoverflow_28801();
	}
	LA9: ;
}

static N_INLINE(void, popFrame)(void) {
	frameptr_26036 = (*frameptr_26036).prev;
}

static N_INLINE(Cell54507*, usrtocell_58458)(void* usr) {
	Cell54507* result;
	nimfr("usrToCell", "gc.nim")
	result = 0;
	nimln(131, "gc.nim");
	result = ((Cell54507*) ((NI)((NU64)(((NI) (usr))) - (NU64)(((NI)sizeof(Cell54507))))));
	popFrame();
	return result;
}

static N_INLINE(void, rtladdzct_60001)(Cell54507* c) {
	nimfr("rtlAddZCT", "gc.nim")
	nimln(212, "gc.nim");
	addzct_58435((&gch_56859.zct), c);
	popFrame();
}

static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src) {
	nimfr("asgnRefNoCycle", "gc.nim")
	nimln(264, "gc.nim");
	{
		Cell54507* c;
		nimln(349, "system.nim");
		if (!!((src == NIM_NIL))) goto LA3;
		nimln(265, "gc.nim");
		c = usrtocell_58458(src);
		nimln(182, "gc.nim");
		(*c).refcount += ((NI) 8);
	}
	LA3: ;
	nimln(267, "gc.nim");
	{
		Cell54507* c;
		nimln(349, "system.nim");
		if (!!(((*dest) == NIM_NIL))) goto LA7;
		nimln(268, "gc.nim");
		c = usrtocell_58458((*dest));
		nimln(269, "gc.nim");
		{
			nimln(180, "gc.nim");
			(*c).refcount -= ((NI) 8);
			nimln(181, "gc.nim");
			if (!((NU64)((*c).refcount) < (NU64)(((NI) 8)))) goto LA11;
			nimln(270, "gc.nim");
			rtladdzct_60001(c);
		}
		LA11: ;
	}
	LA7: ;
	nimln(271, "gc.nim");
	(*dest) = src;
	popFrame();
}

static N_INLINE(void, nimGCunrefNoCycle)(void* p) {
	Cell54507* c;
	nimfr("nimGCunrefNoCycle", "gc.nim")
	nimln(246, "gc.nim");
	c = usrtocell_58458(p);
	nimln(248, "gc.nim");
	{
		nimln(180, "gc.nim");
		(*c).refcount -= ((NI) 8);
		nimln(181, "gc.nim");
		if (!((NU64)((*c).refcount) < (NU64)(((NI) 8)))) goto LA3;
		nimln(249, "gc.nim");
		rtladdzct_60001(c);
	}
	LA3: ;
	popFrame();
}

static N_INLINE(void, sysfatal_192107)(NimStringDesc* message) {
	Deadthreaderror3678* e;
	NimStringDesc* LOC1;
	nimfr("sysFatal", "system.nim")
	e = 0;
	nimln(2525, "system.nim");
	e = (Deadthreaderror3678*) newObj((&NTI192114), sizeof(Deadthreaderror3678));
	(*e).Sup.Sup.m_type = (&NTI3678);
	nimln(2526, "system.nim");
	LOC1 = 0;
	LOC1 = (*e).Sup.message; (*e).Sup.message = copyStringRC1(message);
	if (LOC1) nimGCunrefNoCycle(LOC1);
	nimln(2527, "system.nim");
	raiseException((Exception*)e, "DeadThreadError");
	popFrame();
}

N_NIMCALL(void, addlogger_192076)(FILE* file) {
	Logger192006 LOC1;
	Message192010 LOC2;
	nimfr("addLogger", "logger.nim")
	nimln(29, "logger.nim");
	memset((void*)(&LOC1), 0, sizeof(LOC1));
	LOC1.file = file;
	loggers_192065 = (TY192035*) incrSeqV2(&(loggers_192065)->Sup, sizeof(Logger192006));
	loggers_192065->data[loggers_192065->Sup.len] = LOC1;
	++loggers_192065->Sup.len;
	nimln(30, "logger.nim");
	memset((void*)(&LOC2), 0, sizeof(LOC2));
	memset((void*)(&LOC2), 0, sizeof(LOC2));
	LOC2.kind = ((NU8) 1);
	if (!(((2 &(1U<<((NU)(LOC2.kind)&7U)))!=0))) raiseFieldError(((NimStringDesc*) &TMP615));
	genericSeqAssign((&LOC2.kindU.S2.loggers), loggers_192065, (&NTI192035));
	send_192091((&channel_192070), (&LOC2));
	popFrame();
}

static N_INLINE(NI, addInt)(NI a, NI b) {
	NI result;
{	result = 0;
	result = (NI)((NU64)(a) + (NU64)(b));
	{
		NIM_BOOL LOC3;
		LOC3 = 0;
		LOC3 = (((NI) 0) <= (NI)(result ^ a));
		if (LOC3) goto LA4;
		LOC3 = (((NI) 0) <= (NI)(result ^ b));
		LA4: ;
		if (!LOC3) goto LA5;
		goto BeforeRet;
	}
	LA5: ;
	raiseOverflow();
	}BeforeRet: ;
	return result;
}

N_NIMCALL(void, threadlog_192142)(void) {
	TY192035* loggers;
	time_t lasttime;
	NimStringDesc* timestr;
	nimfr("threadLog", "logger.nim")
	nimln(34, "logger.nim");
	loggers = newseq_192030(((NI) 0));
	lasttime = 0;
	nimln(36, "logger.nim");
	timestr = copyString(((NimStringDesc*) &TMP616));
	{
		nimln(38, "logger.nim");
		while (1) {
			Message192010 msg;
			memset((void*)(&msg), 0, sizeof(msg));
			nimln(39, "logger.nim");
			chckNil((void*)(&msg));
			memset((void*)(&msg), 0, sizeof(msg));
			recv_192176((&channel_192070), (&msg));
			nimln(40, "logger.nim");
			switch (msg.kind) {
			case ((NU8) 0):
			{
				time_t newtime;
				NimStringDesc* str;
				TY192201 LOC10;
				nimln(42, "logger.nim");
				newtime = gettime_115839();
				nimln(43, "logger.nim");
				{
					NIM_BOOL LOC6;
					Timeinfo115804 LOC9;
					nimln(349, "system.nim");
					LOC6 = 0;
					LOC6 = ntEqTime(newtime, lasttime);
					if (!!(LOC6)) goto LA7;
					nimln(44, "logger.nim");
					memset((void*)(&LOC9), 0, sizeof(LOC9));
					LOC9.Sup.m_type = (&NTI115804);
					getlocaltime_115841(newtime, (&LOC9));
					timestr = format_118012((&LOC9), ((NimStringDesc*) &TMP617));
					nimln(45, "logger.nim");
					lasttime = newtime;
				}
				LA7: ;
				nimln(47, "logger.nim");
				memset((void*)LOC10, 0, sizeof(LOC10));
				LOC10[0] = copyString(timestr);
				if (!(((1 &(1U<<((NU)(msg.kind)&7U)))!=0))) raiseFieldError(((NimStringDesc*) &TMP620));
				LOC10[1] = copyString(msg.kindU.S1.module);
				if (!(((1 &(1U<<((NU)(msg.kind)&7U)))!=0))) raiseFieldError(((NimStringDesc*) &TMP621));
				LOC10[2] = copyString(msg.kindU.S1.text);
				str = nsuFormatOpenArray(((NimStringDesc*) &TMP619), LOC10, 3);
				{
					Logger192006 logger_192402;
					NI i_192435;
					NI L_192437;
					memset((void*)(&logger_192402), 0, sizeof(logger_192402));
					nimln(3361, "system.nim");
					i_192435 = ((NI) 0);
					nimln(3362, "system.nim");
					L_192437 = (loggers ? loggers->Sup.len : 0);
					{
						nimln(3363, "system.nim");
						while (1) {
							NI TMP622;
							if (!(i_192435 < L_192437)) goto LA13;
							nimln(3364, "system.nim");
							if ((NU)(i_192435) >= (NU)(loggers->Sup.len)) raiseIndexError();
							logger_192402 = loggers->data[i_192435];
							nimln(50, "logger.nim");
							write_15489(logger_192402.file, str);
							nimln(53, "logger.nim");
							{
								NI LOC16;
								LOC16 = 0;
								LOC16 = peek_192406((&channel_192070));
								if (!(LOC16 == ((NI) 0))) goto LA17;
								nimln(54, "logger.nim");
								fflush(logger_192402.file);
							}
							LA17: ;
							nimln(3365, "system.nim");
							TMP622 = addInt(i_192435, ((NI) 1));
							i_192435 = (NI)(TMP622);
							nimln(3366, "system.nim");
							{
								if (!!(((loggers ? loggers->Sup.len : 0) == L_192437))) goto LA21;
								failedassertimpl_97116(((NimStringDesc*) &TMP623));
							}
							LA21: ;
						} LA13: ;
					}
				}
			}
			break;
			case ((NU8) 1):
			{
				nimln(56, "logger.nim");
				if (!(((2 &(1U<<((NU)(msg.kind)&7U)))!=0))) raiseFieldError(((NimStringDesc*) &TMP615));
				genericSeqAssign((&loggers), msg.kindU.S2.loggers, (&NTI192035));
			}
			break;
			case ((NU8) 2):
			{
				{
					Logger192006 logger_192429;
					NI i_192441;
					NI L_192443;
					memset((void*)(&logger_192429), 0, sizeof(logger_192429));
					nimln(3361, "system.nim");
					i_192441 = ((NI) 0);
					nimln(3362, "system.nim");
					L_192443 = (loggers ? loggers->Sup.len : 0);
					{
						nimln(3363, "system.nim");
						while (1) {
							NI TMP624;
							if (!(i_192441 < L_192443)) goto LA27;
							nimln(3364, "system.nim");
							if ((NU)(i_192441) >= (NU)(loggers->Sup.len)) raiseIndexError();
							logger_192429 = loggers->data[i_192441];
							nimln(60, "logger.nim");
							fflush(logger_192429.file);
							nimln(3365, "system.nim");
							TMP624 = addInt(i_192441, ((NI) 1));
							i_192441 = (NI)(TMP624);
							nimln(3366, "system.nim");
							{
								if (!!(((loggers ? loggers->Sup.len : 0) == L_192443))) goto LA30;
								failedassertimpl_97116(((NimStringDesc*) &TMP623));
							}
							LA30: ;
						} LA27: ;
					}
				}
				nimln(61, "logger.nim");
				goto LA1;
			}
			break;
			}
		}
	} LA1: ;
	popFrame();
}

static N_INLINE(void, jointhread_192458)(Thread23035* t) {
	int LOC1;
	LOC1 = 0;
	LOC1 = pthread_join((*t).Sup.sys, NIM_NIL);
}

static N_INLINE(NI, find_192497)(FILE** a, NI aLen0, FILE* item) {
	NI result;
	nimfr("find", "system.nim")
{	result = 0;
	{
		FILE* i_192531;
		NI i_192555;
		i_192531 = 0;
		nimln(1965, "system.nim");
		i_192555 = ((NI) 0);
		{
			nimln(1966, "system.nim");
			while (1) {
				NI TMP625;
				NI TMP626;
				if (!(i_192555 < aLen0)) goto LA3;
				nimln(1967, "system.nim");
				if ((NU)(i_192555) >= (NU)(aLen0)) raiseIndexError();
				i_192531 = a[i_192555];
				nimln(2190, "system.nim");
				{
					if (!(i_192531 == item)) goto LA6;
					goto BeforeRet;
				}
				LA6: ;
				nimln(2191, "system.nim");
				TMP625 = addInt(result, ((NI) 1));
				result = (NI)(TMP625);
				nimln(1968, "system.nim");
				TMP626 = addInt(i_192555, ((NI) 1));
				i_192555 = (NI)(TMP626);
			} LA3: ;
		}
	}
	nimln(2192, "system.nim");
	result = ((NI) -1);
	}BeforeRet: ;
	popFrame();
	return result;
}

static N_INLINE(NIM_BOOL, contains_192487)(FILE** a, NI aLen0, FILE* item) {
	NIM_BOOL result;
	NI LOC1;
	nimfr("contains", "system.nim")
{	result = 0;
	nimln(2197, "system.nim");
	nimln(352, "system.nim");
	nimln(353, "system.nim");
	nimln(2197, "system.nim");
	LOC1 = 0;
	LOC1 = find_192497(a, aLen0, item);
	result = (((NI) 0) <= LOC1);
	goto BeforeRet;
	}BeforeRet: ;
	popFrame();
	return result;
}

N_NOCONV(void, stoplog_192444)(void) {
	Message192010 LOC1;
	nimfr("stopLog", "logger.nim")
	nimln(64, "logger.nim");
	memset((void*)(&LOC1), 0, sizeof(LOC1));
	memset((void*)(&LOC1), 0, sizeof(LOC1));
	LOC1.kind = ((NU8) 2);
	send_192091((&channel_192070), (&LOC1));
	nimln(65, "logger.nim");
	jointhread_192458((&thread_192073));
	nimln(66, "logger.nim");
	close_192465((&channel_192070));
	{
		Logger192006 logger_192482;
		NI i_192560;
		NI L_192562;
		memset((void*)(&logger_192482), 0, sizeof(logger_192482));
		nimln(3361, "system.nim");
		i_192560 = ((NI) 0);
		nimln(3362, "system.nim");
		L_192562 = (loggers_192065 ? loggers_192065->Sup.len : 0);
		{
			nimln(3363, "system.nim");
			while (1) {
				NI TMP627;
				if (!(i_192560 < L_192562)) goto LA4;
				nimln(3364, "system.nim");
				if ((NU)(i_192560) >= (NU)(loggers_192065->Sup.len)) raiseIndexError();
				logger_192482 = loggers_192065->data[i_192560];
				nimln(69, "logger.nim");
				{
					TY192483 LOC7;
					NIM_BOOL LOC8;
					nimln(1104, "system.nim");
					LOC7[0] = stdout;
					LOC7[1] = stderr;
					LOC8 = 0;
					LOC8 = contains_192487(LOC7, 2, logger_192482.file);
					if (!!(LOC8)) goto LA9;
					nimln(70, "logger.nim");
					fclose(logger_192482.file);
				}
				LA9: ;
				nimln(3365, "system.nim");
				TMP627 = addInt(i_192560, ((NI) 1));
				i_192560 = (NI)(TMP627);
				nimln(3366, "system.nim");
				{
					if (!!(((loggers_192065 ? loggers_192065->Sup.len : 0) == L_192562))) goto LA13;
					failedassertimpl_97116(((NimStringDesc*) &TMP623));
				}
				LA13: ;
			} LA4: ;
		}
	}
	popFrame();
}

static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src) {
	memcpy(((NCSTRING) ((&(*dest).data[((*dest).Sup.len)- 0]))), ((NCSTRING) ((*src).data)), (NI)((*src).Sup.len + ((NI) 1)));
	(*dest).Sup.len += (*src).Sup.len;
}

N_NIMCALL(void, send_192563)(NimStringDesc* module, NimStringDesc** args, NI argsLen0) {
	Message192010 msg;
	Message192010 LOC1;
	nimfr("send", "logger.nim")
	memset((void*)(&msg), 0, sizeof(msg));
	nimln(73, "logger.nim");
	memset((void*)(&LOC1), 0, sizeof(LOC1));
	memset((void*)(&LOC1), 0, sizeof(LOC1));
	LOC1.kind = ((NU8) 0);
	if (!(((1 &(1U<<((NU)(LOC1.kind)&7U)))!=0))) raiseFieldError(((NimStringDesc*) &TMP620));
	LOC1.kindU.S1.module = copyString(module);
	if (!(((1 &(1U<<((NU)(LOC1.kind)&7U)))!=0))) raiseFieldError(((NimStringDesc*) &TMP621));
	LOC1.kindU.S1.text = copyString(((NimStringDesc*) &TMP616));
	memcpy((void*)(&msg), (NIM_CONST void*)(&LOC1), sizeof(msg));
	{
		NimStringDesc* arg_192578;
		NI i_192595;
		arg_192578 = 0;
		nimln(1965, "system.nim");
		i_192595 = ((NI) 0);
		{
			nimln(1966, "system.nim");
			while (1) {
				NI TMP628;
				if (!(i_192595 < argsLen0)) goto LA4;
				nimln(1967, "system.nim");
				if ((NU)(i_192595) >= (NU)(argsLen0)) raiseIndexError();
				arg_192578 = args[i_192595];
				nimln(75, "logger.nim");
				if (!(((1 &(1U<<((NU)(msg.kind)&7U)))!=0))) raiseFieldError(((NimStringDesc*) &TMP621));
				msg.kindU.S1.text = resizeString(msg.kindU.S1.text, arg_192578->Sup.len + 0);
appendString(msg.kindU.S1.text, arg_192578);
				nimln(1968, "system.nim");
				TMP628 = addInt(i_192595, ((NI) 1));
				i_192595 = (NI)(TMP628);
			} LA4: ;
		}
	}
	nimln(76, "logger.nim");
	send_192091((&channel_192070), (&msg));
	popFrame();
}
NIM_EXTERNC N_NOINLINE(void, HEX00_loggerInit000)(void) {
	nimfr("logger", "logger.nim")
	nimln(23, "logger.nim");
	loglevel_192026 = ((NU8) 1);
	nimln(24, "logger.nim");
	asgnRefNoCycle((void**) (&loggers_192065), newseq_192030(((NI) 0)));
	nimln(108, "logger.nim");
	open_192667((&channel_192070));
	nimln(109, "logger.nim");
	createthread_23028((&thread_192073), threadlog_192142);
	nimln(110, "logger.nim");
	atexit(stoplog_192444);
	popFrame();
}

NIM_EXTERNC N_NOINLINE(void, HEX00_loggerDatInit000)(void) {
static TNimNode* TMP611[3];
NI TMP613;
static char* NIM_CONST TMP612[3] = {
"write", 
"update", 
"stop"};
static TNimNode* TMP614[2];
static TNimNode TMP606[11];
NTI192006.size = sizeof(Logger192006);
NTI192006.kind = 18;
NTI192006.base = 0;
NTI192006.flags = 3;
TMP606[0].kind = 1;
TMP606[0].offset = offsetof(Logger192006, file);
TMP606[0].typ = (&NTI15004);
TMP606[0].name = "file";
NTI192006.node = &TMP606[0];
NTI192010.size = sizeof(Message192010);
NTI192010.kind = 18;
NTI192010.base = 0;
NTI192010.flags = 2;
NTI192008.size = sizeof(NU8);
NTI192008.kind = 14;
NTI192008.base = 0;
NTI192008.flags = 3;
for (TMP613 = 0; TMP613 < 3; TMP613++) {
TMP606[TMP613+2].kind = 1;
TMP606[TMP613+2].offset = TMP613;
TMP606[TMP613+2].name = TMP612[TMP613];
TMP611[TMP613] = &TMP606[TMP613+2];
}
TMP606[5].len = 3; TMP606[5].kind = 2; TMP606[5].sons = &TMP611[0];
NTI192008.node = &TMP606[5];
TMP606[1].kind = 3;
TMP606[1].offset = offsetof(Message192010, kind);
TMP606[1].typ = (&NTI192008);
TMP606[1].name = "kind";
TMP606[1].sons = &NimDT_192010_kind[0];
TMP606[1].len = 3;
TMP614[0] = &TMP606[7];
TMP606[7].kind = 1;
TMP606[7].offset = offsetof(Message192010, kindU.S1.module);
TMP606[7].typ = (&NTI138);
TMP606[7].name = "module";
TMP614[1] = &TMP606[8];
TMP606[8].kind = 1;
TMP606[8].offset = offsetof(Message192010, kindU.S1.text);
TMP606[8].typ = (&NTI138);
TMP606[8].name = "text";
TMP606[6].len = 2; TMP606[6].kind = 2; TMP606[6].sons = &TMP614[0];
NimDT_192010_kind[0] = &TMP606[6];
TMP606[9].kind = 1;
TMP606[9].offset = offsetof(Message192010, kindU.S2.loggers);
TMP606[9].typ = (&NTI192035);
TMP606[9].name = "loggers";
NimDT_192010_kind[1] = &TMP606[9];
TMP606[10].len = 0; TMP606[10].kind = 2;
NimDT_192010_kind[2] = &TMP606[10];
NTI192010.node = &TMP606[1];
}

